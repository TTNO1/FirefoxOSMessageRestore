## ![Title](https://raw.githubusercontent.com/TTNO1/FirefoxOSMessageRestore/refs/heads/master/readme/title.png)
### Restoring SMS/MMS Messages on Firefox/Kai OS from Backup
This guide will explain how to transfer text messages from an old phone onto a new FirefoxOS/KaiOS phone. The steps in this guide were made and tested on a Nokia 2780 but they should work on all Firefox/Kai OS phones. This guide includes steps for restoring from a backup file generated by [SMS Backup & Restore](https://play.google.com/store/apps/details?id=com.riteshsahu.SMSBackupRestore&hl=en_US) on Android and from another Firefox/Kai OS phone. For *SMS Backup & Restore* backups, this guide uses a Firefox extension that converts the backup into a database file in the format that Firefox/Kai OS use. The extension utilizes XPCOM and thus only runs on Firefox version 56 and earlier.

### What you will need
 - A Linux environment (For jailbreaking) (WSL 2 might work but you will need USB access)
 - Firefox Developer Edition Version 56 (can be downloaded [here](https://archive.mozilla.org/pub/devedition/releases/56.0b12/))
 - Write access to UserData partition of the new phone (see below)
 - A backup XML file from an Android phone or an old Firefox/Kai phone with read access to userdata partition

### Accessing UserData Partition
You will need write access to the userdata partition on the new phone. For devices other than the Nokia 2780, check its [BananaHackers page](https://wiki.bananahackers.net/devices) for help.

For the Nokia 2780, follow the steps [here](https://git.abscue.de/affe_null/weeknd-toolbox/). You will need a Linux system for this. **Beware:** part of this process involves completely wiping the phone. Note that for the "building" and "booting" steps, you will need to install a few dependencies; however, there is no list of these dependencies so you will have to do some trial and error until it runs successfully. Proceed to the "Preparation" step and stop before the "Getting adb to work" step. Note that you will have to reboot into KaiOS after disabling encryption and then back into the hacking toolbox in order for the files to be populated after the reset.

### Running the Extension
Download Firefox Developer Edition from [here](https://archive.mozilla.org/pub/devedition/releases/56.0b12/) and install it. **Before you run it, turn off your internet to prevent automatic updates.** Then click the hamburger menu in the top right

![Hamburger Icon](https://raw.githubusercontent.com/TTNO1/FirefoxOSMessageRestore/refs/heads/master/readme/toolbar-hamburger.png)

then click options > scroll down > firefox developer edition updates > select "Never check for updates". You can now turn your internet back on. It is important to prevent auto updates because **the extension will not work on newer versions**. If it does update itself, you will need to reinstall version 56. Next, open a new tab and type `about:config` into the address bar and hit enter. Type `xpinstall.signatures.required` into the search box, right click the property that comes up and click "toggle" so that it is set to false. This setting allows you to install custom (unverified) extensions from a file--this is neccessary because the Firefox extension store no longer supports extensions of this type (XPCOM). Now download the `MessageRestore.xpi` file [here](https://github.com/TTNO1/FirefoxOSMessageRestore/releases/latest) and drag it into an open window of Firefox Developer Edition 56. It should ask if you want to install it (click yes) and to restart Firefox (click restart). When it reopens, you should see an icon in the top right that looks like this:

![Message Bubble Icon](https://raw.githubusercontent.com/TTNO1/FirefoxOSMessageRestore/refs/heads/master/readme/toolbar-msg-icon.png)

Click the icon. A window should then popup that looks like this:

![Popup Window](https://raw.githubusercontent.com/TTNO1/FirefoxOSMessageRestore/refs/heads/master/readme/ext-popup.png)

Click the "Choose File" button and select the backup xml file created by the *SMS Backup & Restore* Android app. Then click the "Generate Database" button and wait for it to say "Complete!" (the data will be corrupt if you do not wait for "Complete!"). 

![Popup Showing Complete Message](https://raw.githubusercontent.com/TTNO1/FirefoxOSMessageRestore/refs/heads/master/readme/ext-popup-complete.png)

### Copying Database to Phone
Next, you need to copy the generated database files from Firefox onto your new phone. On Windows, the database files are located at `C:\Users\<username>\AppData\Roaming\Mozilla\Firefox\Profiles\<rand>.dev-edition-default-<num>\storage\permanent\chrome\idb`. On other operating systems, they will be located in a similar directory (wherever app data is stored) but I do not know exactly where. You will need to copy the `226660312ssm.sqlite` file and the `226660312ssm.files` folder. Plug your phone into your computer and boot into the hacker toolbox. Select "USB storage" and then "userdata". Browse the phone and go to the path `/b2g/mozilla/<rand>.default/storage/permanent/chrome/idb`. Copy the `226660312ssm.sqlite` file and `226660312ssm.files` folder from the phone directory to a place on your computer to serve as a backup (if something goes wrong or you need to undo the restoration, you will need to copy these backed-up files back onto the phone). Now move the `226660312ssm.sqlite` file and `226660312ssm.files` folder that you copied from Firefox Developer Edition onto the phone to replace the equivalent file and folder that are already there. Now eject the phone and reboot into Firefox/Kai OS. Your text messages should now be restored (note you will have to wait a second after opening the messages app for the cache to update). If there are any problems with the restoration, please let me know and I will try to help.
### Restoring from an Old Firefox/Kai OS Phone
To restore messages from a Firefox/Kai phone instead of from Android, copy the `226660312ssm.sqlite` file and `226660312ssm.files` folder off of the old phone and move them onto the new phone.
### Multiple Database Generations
If you use the Firefox extension multiple times (i.e. click the "Generate Database" button multiple times) it will add to the database file in the AppData directory: it will not create a new database file. Thus, if you want to perform multiple separate restorations or redo a restoration, you need to first reset Firefox Developer Edition. To do this, first, turn off your internet to prevent auto updates as resetting the browser will reset the update setting. Then click the hamburger icon in the top right > click the question mark icon in the bottom right of the popup > click "Troubleshooting Information" > click "Refresh Firefox Developer Edition..." in the box in the top right. Now repeat the process of disabling auto updates and enabling unverified extensions before repeating the process.
